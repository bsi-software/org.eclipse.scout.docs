////
Howto:
- Write this document such that it helps people to migrate. Describe what they should do.
- Chronological order is not necessary.
- Choose the right top level chapter (java, js, other)
- Use "WARNING: {NotReleasedWarning}" on its own line to mark parts about not yet released code (also add a "(since <version>)" suffix to the chapter title)
- Use "title case" in chapter titles (https://english.stackexchange.com/questions/14/)
////

ifndef::finaldoc[]
include::../_initDoc.adoc[]
endif::finaldoc[]

// double underscore
:dus: __

== About This Document

This document describes all relevant changes *from Eclipse Scout {scout-previous-version} to Eclipse Scout {scout-version}*. If existing code has to be migrated, instructions are provided here.

== Obtaining the Latest Version

=== Scout Runtime for Java

Scout Runtime artifacts for Java are distributed using Maven Central:

* {maven-central-link} on _Maven Central_
* {mvnrepository-link} on _mvnrepository.com_

Usage example in the parent POM of your Scout application:

[source,xml]
[subs="verbatim,attributes"]
----
<dependency>
    <groupId>org.eclipse.scout.rt</groupId>
    <artifactId>org.eclipse.scout.rt</artifactId>
    <version>{maven-version}</version>
    <type>pom</type>
    <scope>import</scope>
</dependency>
----

=== Scout Runtime for JavaScript

Scout Runtime artifacts for JavaScript are distributed using npm:

* https://www.npmjs.com/package/@eclipse-scout/core[Scout Core Runtime]
* https://www.npmjs.com/search?q=%40eclipse-scout[All official Scout JavaScript packages]

Usage example in your package.json:

[source,json]
[subs="verbatim,attributes"]
----
{
  "name": "my-module",
  "version": "1.0.0",
  "dependencies": {
    "@eclipse-scout/core": "{node-version}",
    "jquery": "3.5.1"
  }
}
----

The pre-built Scout JavaScript assets are also available using a CDN (e.g. to be directly included in a html document):
https://www.jsdelivr.com/package/npm/@eclipse-scout/core?path=dist

=== IDE Tooling (Scout SDK)

Starting with Scout 11 the IDE Tooling requires at least Java 11 to run.
With the help of the SDK plugins you can still develop applications running with Java 8, but the IDE itself requires Java 11 or newer.

Scout officially supports https://www.jetbrains.com/idea/[IntelliJ IDEA] and {scout-sdk-download-link}.

==== IntelliJ IDEA

You can download the Scout plugin for IntelliJ IDEA from the https://plugins.jetbrains.com/plugin/13393-eclipse-scout/[JetBrains Plugin Repository] or you can use the plugins client built into IntelliJ IDEA.
Please refer to the https://www.jetbrains.com/help/idea/managing-plugins.html[IntelliJ Help] on how to install and manage plugins.

==== Eclipse

You can download the complete Eclipse IDE with Scout SDK included here: +
{scout-sdk-download-link}

To install the Scout SDK into your existing Eclipse IDE, use this P2 update site: +
{scout-sdk-update-site}

== TypeVersion Annotation Type Change

The type version of a data object is used to identify a certain structure version of the stored data object.
A data object may be stored in a database or be available as a container to export certain data for import in a different compatible system.
Such a data object may evolve over time and undergo structural changes.
Some structural changes make it necessary to apply migrations to existing serialized data objects to comply with the new structure.

In order to prepare for migration support, the type version annotation so far containing a String value changes to a value of Class<? extends ITypeVersion>.
A ITypeVersion represents a namespace/version and it's dependencies.

*Migration*

For each different String value used in type version annotation, create an implementation of `ITypeVersion` as described
in _Data Objects_/_Namespace and ITypeVersion_ in the technical documentation.

`DataObjectInventory#getTypeVersion` returns `NamespaceVersion` instead of `String`.
Use `NamespaceVersion::unwrap` to access text representation.

== Annotation EnumVersion removed

`EnumVersion` was designed for migration support similar as the TypeVersion but was never part of any serialization output of a data object,
therefore couldn't be used as indicator for migrations.
Support for `EnumVersion` is removed.

*Migration*

Remove `EnumVersion` annotation on `IEnum` implementors.

== Native Notification Support

The new notifications displayed by the browser use the application logo configured in `AbstractDesktop#getConfiguredLogoId()` by default.

If you use native notifications, you should provide a logo with a resolution of at least 150x150 px.
If your application logo already has such a resolution, it should be fine.
If your application logo has a lower resolution or is an SVG, you should use a different image for the notifications (SVGs are not supported by Chrome notifications).
To do so, just configure the native notification defaults on your desktop.

[source,java]
[subs="verbatim,attributes"]
----
@Override
protected NativeNotificationDefaults getConfiguredNativeNotificationDefaults() {
  return super.getConfiguredNativeNotificationDefaults()
    .withIconId("notification_logo.png");
}
----

== Application Logo / Info Form

The image `application_logo_large` and the constant `AbstractIcons.ApplicationLogo` have been removed.
The name was confusing and it was only used for the `ScoutInfoForm`.
The info form now uses the logo of the desktop (`IDesktop#getLogoId())` by default.
So if you prefer to use a different logo for the info form, just extend the info form, override the method `getProductLogo()` and return the name of your preferred image.

In case you don't use SVG logos yet, you should consider doing so to prevent blurry logos.

== Style
=== LESS Variables

- @active-inverted-background-color -> @selected-background-color
- @active-inverted-color -> @selected-color
- @navigation-background-color -> @desktop-navigation-background-color
- @navigation-color -> @desktop-navigation-color
- @outline-title-margin-left/right -> @outline-title-padding-left/right
- @group-box-title-margin-top -> @group-box-header-margin-top
- @group-box-title-border-width -> @group-box-header-border-width

Notes:
@desktop-navigation-background-color now points to @desktop-header-background-color;
Instead of customizing the navigation background color it is suggested to now customize the header background color.

=== Rules
- .menubox -> .menubar-box
- .group-box-title -> .group-box-header > .title
- border-bottom of group-box-title -> .group-box-header > .bottom-border
- .tab-box-bottom-border -> .bottom-border

// TODO cgu describe: button, menu styles

=== Icons
TODO describe icon style changes

Some icons have been removed because they are not used by Scout itself anymore.
If you need these icons, please add them to your own icon library.
If you don't already have a custom icon library, please see our guide on how to create one:
https://eclipsescout.github.io/11.0/technical-guide.html#icons
The icons from Scout can be found here: https://git.eclipse.org/c/scout/org.eclipse.scout.rt.git/tree/org.eclipse.scout.rt.ui.html/src/icons?h=releases/11.0
There you also find a `selection.json` that can be used to import the icons to https://icomoon.io/app[IcoMoon].

- MENU_BOLD (uF0C9)
- LIST_UL_BOLD (uF0CA)
- LIST_OL_BOLD (uF0CB)
- GRAPH_BOLD (uE023)
- CATEGORY_BOLD (uE024)
- ELLIPSIS-V-BOLD / VERTICAL_DOTS (uE040)
- SPINNER (uE044)
- ANGLE-DOUBLE-LEFT-BOLD (uF100)
- ANGLE-DOUBLE-RIGHT-BOLD (uF101)
- ANGLE-DOUBLE-UP-BOLD (uF102)
- ANGLE-DOUBLE-DOWN-BOLD (uF103)
- BOLD (uE051)
- ITALIC (uE052)
- UNDERLINE (uE053)
- STRIKETHROUGH (uE054)
- LIST-UL (uE055)
- LIST-OL (uE056)
- LIGHTBULB_OFF (uE057)
- LIGHTBULB_ON (uE058)

The following icons have been renamed
- EXCLAMATION_MARK -> EXCLAMATION_MARK_BOLD

== Browser Field

The type of the `data` argument for the callback `execPostMessage` was changed from _String_ to _Object_.
This allows for the widest variety of data that can be sent from an embedded page to your application:

* String
* Number
* Boolean
* IDataObject (objects or arrays)

In previous Scout versions, all messages were always converted to text.
Now, the data type is preserved as accurately as possible.
JSON objects or arrays are converted to IDoEntity or DoList with the help of the IObjectMapper bean.
To use this feature, an implementation of IDataObjectMapper needs to be present at runtime.
If no implementation is available, the data will be converted to text automatically.

*Migration:*

Adjust the signature of all implementations of `AbstractBrowserField#postMessage` in your code.

* Change `execPostMessage(String data, String origin)` to `execPostMessage(Object data, String origin)`.
* If the message sent by the embedded web page is not a text, the appropriate data type is now passed.
Check the expected type using `instanceof` or convert it to String manually.
* If you want objects and arrays to be converted to IDataObjects automatically, make sure there is an
implementation of IObjectMapper present at runtime, e.g. by adding a dependency to the module
_org.eclipse.scout.rt.jackson_ in pom.xml.

== Lazy creation of detailTable and detailForm in Scout JS Pages

In the past when a page was created the embedded detail forms and tables have been created together with the page.
This may lead to a bad performance when an outline containing lots of complex pages is created.

Therefore the containing tables and forms are now only created when the page is activated (e.g. selected by the user).
This is the same behavior as already implemented in Scout Classic since several years.
As a consequence accessing `Page.detailForm` or `Page.detailTable` may now return `null` if the page has not been activated yet.

Check all usages of the `detailForm` and `detailTable` properties of pages in your code and ensure it is guarded with a null check or is only executed when the page has already been activated.

Typically these properties are accessed in the `_init()` function of a page e.g. to attach listeners.
This is no longer possible as these properties are no longer available at that moment.

As an alternative override the `_initDetailForm(form)` or `_initDetailTable(table)` methods if your code exists on a Page (don't forget to add a super call).
If outside a Page listen for the `propertyChange` events for `detailForm` or `detailTable` to execute your detailForm or detailTable dependant code.

Furthermore if you use the following methods on pages, please rename them as follows:

* from `createDetailForm` to `_createDetailForm`
* from `_createTable` to `_createDetailTable`
* from `_initTable` to `_initDetailTable`
* from `_ensureDetailForm` to `ensureDetailForm`
